<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SFSC Policies and Procedures</title>
  <style>
    body {
      font-family: 'Segoe UI', 'Arial', sans-serif;
      background: #fafbfb;
      color: #333;
      margin: 0;
      padding: 10px;
    }

    .container {
      max-width: 1280px;
      background: #fff;
      padding: 10px;
      margin: auto;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .header-box {
      background-color: #333366; /* SFSC Blue */
      color: white;
      border-radius: 12px 12px 0 0;
      padding: 20px;
      margin: -10px -10px 0 -10px;
    }

    .header-content {
      display: flex;
      align-items: center;
    }

    .header-icon {
      font-size: 1.8em;
      margin-right: 12px;
    }

    .header-title {
      font-size: 1.2em;
      font-weight: bold;
    }

    .header-subtitle {
      font-size: 0.95em;
      color: #e0e0e0;
    }

    .search-bar {
      display: flex;
      justify-content: center;
      margin: 1rem 0;
    }

    .search-bar input {
      width: 100%;
      padding: 0.5rem;
      font-size: clamp(0.9rem, 3vw, 1rem);
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
    }

    .search-bar input:focus {
      border-color: #f37920;
      box-shadow: 0 0 8px rgba(244, 121, 32, 0.3);
      outline: none;
    }

    .category {
      margin-top: 2rem;
    }

    .category h2 {
      font-size: 1.6rem;
      color: #f37920;
      position: relative;
      margin-bottom: 1rem;
    }

    h2::after {
      content: '';
      position: absolute;
      bottom: -3px;
      left: 0;
      width: 100%;
      height: 3px;
      background:#f37920;
    }

    .item {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid #e0e0e0;
    }

    .item-id,
    .item-type {
      min-width: 100px;
      margin-right: 20px;
      font-weight: bold;
    }

    .item-type {
      background-color: #e9ecef;
      border-radius: 15px;
      padding: 4px 10px;
      color: #555;
    }

    .item-title a {
      color: #333366;
      text-decoration: none;
      font-weight: 500;
      transition: 0.2s;
    }

    .item-title a:hover {
      color: #f37920;
      text-decoration: underline;
    }

    #loading,
    #error {
      text-align: center;
      font-size: 1.1em;
      margin: 1.5rem 0;
    }

    #loading {
      color: #333366;
    }

    #error {
      color: #fff;
      background: #dc3545;
      padding: 1rem;
      border-radius: 6px;
    }

    @media (max-width: 768px) {
      .item-id, .item-type, .item-title {
        width: 100%;
        margin-bottom: 0.5rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header-box">
      <div class="header-content">
        <!--<span class="header-icon">üìÅ</span>-->
        <div>
          <div class="header-title">üìÅ Policies and Procedures</div>
          <div class="header-subtitle">Browse and search current policies and procedures</div>
        </div>
      </div>
    </div>

    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="Search by ID, title, type, or category..." />
    </div>

    <div id="loading">Loading policies and procedures...</div>
    <div id="error" style="display:none;"></div>
    <div id="items"></div>
  </div>

  <script>
    function parseCSV(csvText) {
      const lines = csvText.trim().split('\n');
      const headers = lines[0].split(',').map(h => h.trim());
      return lines.slice(1).map(line => {
        const values = line.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g) || [];
        return headers.reduce((acc, key, i) => {
          acc[key] = (values[i] || '').replace(/^"|"$/g, '').trim();
          return acc;
        }, {});
      });
    }

    function displayItems(items) {
      const container = document.getElementById('items');
      container.innerHTML = '';
      const categories = {};

      items.forEach(item => {
        const cat = item.category || 'Uncategorized';
        categories[cat] = categories[cat] || [];
        categories[cat].push(item);
      });

      Object.entries(categories).sort().forEach(([cat, entries]) => {
        const section = document.createElement('div');
        section.className = 'category';
        section.innerHTML = `<h2>${cat}</h2>`;
        entries.sort((a, b) => a.id.localeCompare(b.id)).forEach(item => {
          const div = document.createElement('div');
          div.className = 'item';
          div.setAttribute('data-id', item.id.toLowerCase());
          div.setAttribute('data-title', item.title.toLowerCase());
          div.setAttribute('data-category', cat.toLowerCase());
          div.setAttribute('data-type', item.type.toLowerCase());
          div.innerHTML = `
            <span class="item-id">${item.id}</span>
            <span class="item-type">${item.type}</span>
            <span class="item-title"><a href="${item.url}" target="_blank">üìÑ ${item.title}</a></span>
          `;
          section.appendChild(div);
        });
        container.appendChild(section);
      });

      document.getElementById('loading').style.display = 'none';
    }

    function searchItems() {
      const input = document.getElementById('searchInput').value.toLowerCase();
      const items = document.querySelectorAll('.item');
      const categories = document.querySelectorAll('.category');

      if (!input) {
        categories.forEach(cat => (cat.style.display = 'block'));
        items.forEach(item => (item.style.display = 'flex'));
        return;
      }

      categories.forEach(cat => (cat.style.display = 'none'));
      items.forEach(item => {
        const id = item.getAttribute('data-id');
        const title = item.getAttribute('data-title');
        const cat = item.getAttribute('data-category');
        const type = item.getAttribute('data-type');
        const matches = [id, title, cat, type].some(field => field.includes(input));
        item.style.display = matches ? 'flex' : 'none';
        if (matches) item.closest('.category').style.display = 'block';
      });
    }

    document.getElementById('searchInput').addEventListener('input', searchItems);

    Promise.all([
      fetch('https://raw.githubusercontent.com/asjames18/policy_procedure_scraper_sfsc/main/procedures.csv').then(r => r.text()),
      fetch('https://raw.githubusercontent.com/asjames18/policy_procedure_scraper_sfsc/main/policies.csv').then(r => r.text())
    ])
    .then(([procedures, policies]) => {
      const combined = [
        ...parseCSV(procedures).map(p => ({ ...p, type: 'Procedure' })),
        ...parseCSV(policies).map(p => ({ ...p, type: 'Policy' }))
      ];
      displayItems(combined);
    })
    .catch(err => {
      document.getElementById('loading').style.display = 'none';
      document.getElementById('error').style.display = 'block';
      document.getElementById('error').textContent = `Error: ${err.message}`;
    });
  </script>
</body>
</html> 


